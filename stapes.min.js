/*! Stapes.js < http://hay.github.com/stapes > */
;(function(){"use strict";var a="0.8.1",b=1;if(!Object.create)var c=function(){};var d=Array.prototype.slice,e={attributes:{},eventHandlers:{"-1":{}},guid:-1,addEvent:function(a){e.eventHandlers[a.guid][a.type]||(e.eventHandlers[a.guid][a.type]=[]);var b={},c=["guid","handler","scope","type"];for(var d in c){var f=c[d];b[f]=a[f]}e.eventHandlers[a.guid][a.type].push(b)},addEventHandler:function(a,b,c){var f,d={};"string"===e.typeOf(a)?(f=c||!1,d[a]=b):(f=b||!1,d=a);for(var g in d)for(var h=d[g],i=g.split(" "),j=0,k=i.length;k>j;j++){var l=i[j],m={guid:this._guid||this._.guid,handler:h,scope:f,type:l};e.addEvent.call(this,m)}},addGuid:function(a,c){(!a._guid||c)&&(a._guid=b++,e.attributes[a._guid]={},e.eventHandlers[a._guid]={})},attr:function(a){return e.attributes[a]},clone:function(a){var c,b=e.typeOf(a);switch(b){case"object":c=e.extend({},a);break;case"array":c=a.slice(0)}return c},create:function(a){return Object.create?Object.create(a):(c.prototype=a,new c)},createSubclass:function(a,b){function g(){if(!(this instanceof g))throw new Error("Please use 'new' when initializing Stapes classes");this.on&&e.addGuid(this,!0),d.apply(this,arguments)}a=a||{},b=b||!1;var c=a.superclass.prototype,d=e.has(a,"constructor")?a.constructor:function(){};b&&e.extend(c,f),g.prototype=e.create(c),g.prototype.constructor=g;var h={extend:function(){return e.extendThis.apply(this,arguments)},parent:c,proto:function(){return e.extendThis.apply(this.prototype,arguments)},subclass:function(a){return a=a||{},a.superclass=this,e.createSubclass(a)}};e.extend(g,h);for(var i in a){var j="constructor"!==i&&"superclass"!==i;j&&(g.prototype[i]=a[i])}return g},emitEvents:function(a,b,c,f){c=c||!1,f=f||this._guid;for(var g=d.call(e.eventHandlers[f][a]),h=0,i=g.length;i>h;h++){var j=e.extend({},g[h]),k=j.scope?j.scope:this;c&&(j.type=c),j.scope=k,j.handler.call(j.scope,b,j)}},extend:function(){for(var a=d.call(arguments),b=a.shift(),c=0,e=a.length;e>c;c++){var f=a[c];for(var g in f)b[g]=f[g]}return b},extendThis:function(){var a=d.call(arguments);return a.unshift(this),e.extend.apply(this,a)},has:function(a,b){return null!=a&&hasOwnProperty.call(a,b)},hasId:function(a){return a===Object(a)&&e.has(a,"id")?a.id:e.makeUuid()},makeUuid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=0|16*Math.random(),c="x"==a?b:8|3&b;return c.toString(16)})},removeAttribute:function(a,b){b=b||!1;for(var c=e.trim(a).split(" "),d={},f=0,g=c.length;g>f;f++){var h=e.trim(c[f]);h&&(d.key=h,d.oldValue=e.attr(this._guid)[h],delete e.attr(this._guid)[h],b||(this.emit("change",h),this.emit("change:"+h),this.emit("mutate",d),this.emit("mutate:"+h,d),this.emit("remove",h),this.emit("remove:"+h)),delete d.oldValue)}},removeEventHandler:function(a,b){var c=e.eventHandlers[this._guid];if(a&&b){if(c=c[a],!c)return;for(var g,d=0,f=c.length;f>d;d++)g=c[d].handler,g&&g===b&&(c.splice(d--,1),f--)}else a?delete c[a]:e.eventHandlers[this._guid]={}},setAttribute:function(a,b,c){c=c||!1;var d=this.has(a),f=e.attr(this._guid)[a];if(b!==f&&(e.attr(this._guid)[a]=b,!c)){this.emit("change",a),this.emit("change:"+a,b);var g={key:a,newValue:b,oldValue:f||null};this.emit("mutate",g),this.emit("mutate:"+a,g);var h=d?"update":"create";this.emit(h,a),this.emit(h+":"+a,b)}},trim:function(a){return a.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},typeOf:function(a){return null===a||"undefined"==typeof a?String(a):Object.prototype.toString.call(a).replace(/\[object |\]/g,"").toLowerCase()},updateAttribute:function(a,b,c){var d=this.get(a),f=e.typeOf(d);("object"===f||"array"===f)&&(d=e.clone(d));var g=b.call(this,d,a);e.setAttribute.call(this,a,g,c||!1)}},f={emit:function(a,b){b="undefined"===e.typeOf(b)?null:b;for(var c=a.split(" "),d=e.emitEvents,f=e.eventHandlers,g=f[-1],h=f[this._guid],i="number"===e.typeOf(this._guid),j=0,k=c.length;k>j;j++){var l=c[j];g.all&&d.call(this,"all",b,l,-1),g[l]&&d.call(this,l,b,l,-1),i&&(h.all&&d.call(this,"all",b,l),h[l]&&d.call(this,l,b))}},off:function(){e.removeEventHandler.apply(this,arguments)},on:function(){e.addEventHandler.apply(this,arguments)}};e.Module=function(){},e.Module.prototype={countBy:function(a){if(!a||"function"!==e.typeOf(a))return{};var b={};return this.each(function(c,d){var f=a.call(this,c,d);e.has(b,f)?b[f]++:b[f]=1}),b},each:function(a,b){var c=e.attr(this._guid);for(var d in c)a.call(b||this,c[d],d)},extend:function(){return e.extendThis.apply(this,arguments)},filter:function(a){var b=[],c=e.attr(this._guid);for(var d in c){var f=c[d];a.call(this,f,d)&&("object"!==e.typeOf(f)||f.id||(f.id=d),b.push(f))}return b},get:function(a){if("string"===e.typeOf(a)){if(arguments.length>1){for(var b={},c=0,d=arguments.length;d>c;c++){var f=arguments[c];b[f]=this.get(f)}return b}return this.has(a)?e.attr(this._guid)[a]:null}if("function"==typeof a){var g=this.filter(a);return g.length?g[0]:null}},getAll:function(){return e.clone(e.attr(this._guid))},getAllAsArray:function(){var a=[],b=e.attr(this._guid);for(var c in b){var d=b[c];"object"!==e.typeOf(d)||d.id||(d.id=c),a.push(d)}return a},groupBy:function(a){if(!a||"function"!==e.typeOf(a))return{};var b={};return this.each(function(c,d){var f=a.call(this,c,d);e.has(b,f)?b[f].push(c):b[f]=[c]}),b},has:function(a){return"undefined"!==e.typeOf(e.attr(this._guid)[a])},keys:function(){if(Object.keys)return Object.keys(e.attr(this._guid));var a=[];return this.each(function(b,c){c&&a.push(c)}),a},map:function(a,b){var c=[];return this.each(function(d,e){c.push(a.call(b||this,d,e))},b||this),c},pluck:function(a){return this.map(function(b){return b[a]})},push:function(a,b){if("array"===e.typeOf(a))for(var c=0,d=a.length;d>c;c++){var f=e.hasId(a[c]);e.setAttribute.call(this,f,a[c],b||!1)}else{var f=e.hasId(a);e.setAttribute.call(this,f,a,b||!1)}return this},remove:function(a,b){return"undefined"===e.typeOf(a)?(e.attributes[this._guid]={},this.emit("change remove")):"function"===e.typeOf(a)?this.each(function(c,d){a(c)&&e.removeAttribute.call(this,d,b)}):e.removeAttribute.call(this,a,b||!1),this},set:function(a,b,c){if("object"===e.typeOf(a))for(var d in a)e.setAttribute.call(this,d,a[d],b||!1);else e.setAttribute.call(this,a,b,c||!1);return this},size:function(){var a=e.attr(this._guid);return a.length===+a.length?a.length:this.keys().length},sortBy:function(a){if(!a||"function"!==e.typeOf(a))return[];var b=this.map(function(b,c){return{value:b,key:c,criteria:a.call(this,b,c)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;if(c!==d){if(c>d||void 0===c)return 1;if(d>c||void 0===d)return-1}return a.index-b.index}),c=[];for(var d in b){var f=b[d],g=e.has(f,"key")?{key:f.key,value:f.value}:f.value;c.push(g)}return c},update:function(a,b,c){return"string"===e.typeOf(a)?e.updateAttribute.call(this,a,b,c||!1):"function"===e.typeOf(a)&&this.each(function(b,c){e.updateAttribute.call(this,c,a)}),this}};var g={_:e,extend:function(){return e.extendThis.apply(e.Module.prototype,arguments)},mixinEvents:function(a){return a=a||{},e.addGuid(a),e.extend(a,f)},on:function(){e.addEventHandler.apply(this,arguments)},subclass:function(a,b){return b=b||!1,a=a||{},a.superclass=b?function(){}:e.Module,e.createSubclass(a,!b)},version:a};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=g),exports.Stapes=g):"function"==typeof define&&define.amd?define(function(){return g}):window.Stapes=g})();